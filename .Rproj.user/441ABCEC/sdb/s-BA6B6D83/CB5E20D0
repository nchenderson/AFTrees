{
    "collab_server" : "",
    "contents" : "\nlibrary(AFTrees)\n\nload(\"~/personalized/Data/solvd.RData\")\n\nSSE <- function(obj) {\n  post.means <- colMeans(obj$Theta)\n  nsubjects <- ncol(obj$Theta)\n  a <- 0\n  b <- 0\n  theta.bar <- mean(obj$Theta)\n  for(k in 1:nsubjects) {\n    a <- a + sum((obj$Theta[,k] - post.means[k])^2)\n    b <- b + sum((obj$Theta[,k] - theta.bar)^2)\n  }\n  a <- a/nsubjects\n  b <- b/nsubjects\n  ans <- list()\n  ans$sse <- a\n  ans$sst <- b\n  return(ans)\n}\n\nnew_solvd <- data.frame(y=log(solvd$ttodthorchfhosp), delta=solvd$status, age=solvd$age, gender=solvd$gend,\n                        lvef=solvd$lvef, trt=solvd$trt, avsys=solvd$avsys, sodium=solvd$sodium, smoke=solvd$smoke,\n                        study=solvd$study, weightkg=solvd$weightkg, trt.alt = 1 - solvd$trt, diabet=solvd$diabet,\n                        histk=solvd$histk, avdia=solvd$avdia, creatinine=solvd$creatinine, beat=solvd$beat,\n                        copd=solvd$copd,anydiurbl=solvd$anydiurbl, depedema=solvd$depedema, crackles=solvd$crackles)\n\nind <- new_solvd$study==\"SOLVD Treatment\"\n\nnew_solvd <- new_solvd[ind,]\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\n\nsystem.time(obj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=500,nskip=500,printevery=100))\n\n### compute goldstandard\ntmp <- SSE(obj)\nGoldStandard <- 1 - tmp$sse/tmp$sst\n\nGoldStandard - rr\n\n\ncount <- 1\nsse_vec <- sst_vec <- rep(0, 18)\n## 1. take out age\nform <- y ~ lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=1000,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n## 2. take out ejection fraction\nform <- y ~ age + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=1000,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n## 3. take out gender\nform <- y ~ age + lvef + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=1000,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n### 4. take out smoke\n\nform <- y ~ age + lvef + gender + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=200,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n## 5. take out diabet\n\nform <- y ~ age + lvef + gender + smoke + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=200,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n## 6. take out sodium\nform <- y ~ age + lvef + gender + smoke + diabet + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=200,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n## 7. take out avsys\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=200,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n## 8. take out weightkg\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=200,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n## 9. take out histk\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=200,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n## 10.   take out avdia\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nobj <- IndivAFT(x.train=X,y.train=new_solvd$y,status=new_solvd$delta,Trt=new_solvd$trt, ndpost=200,nskip=200,printevery=100)\n\ntmp <- SSE(obj)\nsse_vec[count] <- tmp$sse\nsst_vec[count] <- tmp$sst\ncount <- count + 1\n\n\n\nsse_vec/GoldStandard\n\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\nform <- y ~ age + lvef + gender + smoke + diabet + sodium + avsys + weightkg + histk + avdia + creatinine + beat + copd + anydiurbl + depedema - 1\nX <- model.matrix(form, new_solvd)\n\n\n## we want to see who has the largest reduction\nGoldStandard - sse_vec\n\n",
    "created" : 1463866621645.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "2756320858",
    "id" : "CB5E20D0",
    "lastKnownWriteTime" : 6715248618701348145,
    "last_content_update" : 0,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled12"
    },
    "relative_order" : 14,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}