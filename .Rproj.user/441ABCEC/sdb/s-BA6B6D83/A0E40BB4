{
    "collab_server" : "",
    "contents" : "\n\n\n\nload(\"~/personalized/Data/solvd_fit.RData\")\nload(\"~/personalized/Data/solvd_fit_log.RData\")\n\nsource(\"~/personalized/PartialDepend/PartialDependencePlots.R\")\nsolvdT <- read.csv(\"~/personalized/Data/solvdT.csv\")\nsolvd0 <- solvdT[solvdT$gend==0,]\nsolvd1 <- solvdT[solvdT$gend==1,]\n\n#### Now just need partial dependence plots for baseline ejection fraction.\n\n\nform <- ttodthorchfhosp ~ trt + age + smoke + diabet + lvef + himi + nyha + depedema + crackles + weightkg + anydiurbl + avsys + avdia + beat + creatinine + sodium + copd + histk - 1\nformm <- ttodthorchfhosp ~ deathorchfhosp + trt + age + smoke + diabet + lvef + himi + nyha + depedema + crackles + weightkg + anydiurbl + avsys + avdia + beat + creatinine + sodium + copd + histk - 1\n\nsolvd0 <- model.frame(formm, solvd0)\nX0 <- model.matrix(form, solvd0)\n#colnames(XX)[8]\n#colnames(XX)[18]\nstatus0 <- solvd0$deathorchfhosp\ny0 <- solvd0$ttodthorchfhosp\n\n\nform <- ttodthorchfhosp ~ trt + age + smoke + diabet + lvef + himi + nyha + depedema + crackles + weightkg + anydiurbl + avsys + avdia + beat + creatinine + sodium + copd + histk - 1\nformm <- ttodthorchfhosp ~ deathorchfhosp + trt + age + smoke + diabet + lvef + himi + nyha + depedema + crackles + weightkg + anydiurbl + avsys + avdia + beat + creatinine + sodium + copd + histk - 1\n\nsolvd1 <- model.frame(formm, solvd1)\nX1 <- model.matrix(form, solvd1)\n#colnames(XX)[8]\n#colnames(XX)[18]\nstatus1 <- solvd1$deathorchfhosp\ny1 <- solvd1$ttodthorchfhosp\n\n\n\n#zseq <- seq(10, 35, length.out=30)\n#zzseq <- seq(10, 35, length.out=30)\nzseq <- zzseq <- seq(129,148,length.out=20)\nnsk <- 400\nnpo <- 600\npdd0 <- PartialDependence(z=zseq, col.p=18, Trt.col=1, X=X0, y=y0, status=status0, nskip=nsk, ndpost=npo)\npdd1 <- PartialDependence(z=zzseq, col.p=18, Trt.col=1, X=X1, y=y1, status=status1, nskip=nsk, ndpost=npo)\n\n### How to save?\n#save(zseq, zzseq, pdd, pdd_cret, file=\"~/personalized/Data/partialdepend_dat.RData\")\n\n\n\n####  Plot Graphs\n#par(mar=c(5.1,4.1,4.1,2.1)\n## bottom, left, top, right\n\npdsmooth0 <- supsmu(zseq, pdd0$mean)\npdsmooth0_low <- supsmu(zseq, pdd0$lower)\npdsmooth0_up <- supsmu(zseq, pdd0$upper)\n\npdsmooth1 <- supsmu(zseq, pdd1$mean)\npdsmooth1_low <- supsmu(zseq, pdd1$lower)\npdsmooth1_up <- supsmu(zseq, pdd1$upper)\n\n#zseq <- zseq/100\n#postscript(file=\"~/workingpapers/AFTpersonal/Figures/pd_plots.eps\", width=6.5,\n#           height=5, horizontal=FALSE)\npar(mfrow=c(1,1), mar=c(3.6, 3.6,.15,.05), mgp=c(1.75,.5,0))\nplot(zseq, pdd0$mean, type=\"n\", las=1, ylim=c(.2, .9), xlab=\"Ejection Fraction\",\n     ylab=\"Difference in log survival\")\nlines(pdsmooth0$x, pdsmooth0$y)\nlines(pdsmooth1$x, pdsmooth1$y, col=\"red\")\nlines(pdsmooth0$x, pdsmooth0_low$y)\nlines(pdsmooth0$x, pdsmooth0_up$y)\npoints(pdsmooth0$x, pdd1$mean)\npoints(pdsmooth0$x, pdd0$mean)\n\n### red is male, black is female\nsummary(X1[,7])\nsummary(X0[,7])\n\n\n\n\n\n\n\n\nlines(pdsmooth$x/100, pdsmooth_low$y, lty=2)\nlines(pdsmooth$x/100, pdsmooth_up$y, lty=2)\n\n\n\nplot(zzseq, pdd_cret$mean, type=\"n\", las=1, xlim=c(.4, 3.5), ylim=c(-.2,1.0), xlab=\"Creatinine\",\n     ylab=\"Difference in log survival\")\nlines(pdsmooth_cret$x, pdsmooth_cret$y)\nlines(pdsmooth_cret$x, pdsmooth_cret_low$y, lty=2)\nlines(pdsmooth_cret$x, pdsmooth_cret_up$y, lty=2)\n\n## Need to change this to ratio scale\n\nplot(d1$x, d1$y, type=\"n\", xlim=c(.7, 2.9), ylim=c(0,3.3), las=1, xlab=\"Treatment Effect by Gender\", ylab=\"Density\")\nlines(d1$x, d1$y, col=\"red\", lwd=2)\nlines(d2$x, d2$y, col=\"black\", lwd=2)\nlines(d3$x, d3$y, col=\"red\", lwd=2, lty=2)\nlines(d4$x, d4$y, col=\"black\", lwd=2, lty=2)\nlegend(\"topright\", legend=c(\"SOLVD-T: Male\", \"SOLVD-T: Female\", \"SOLVD-P: Male\", \"SOLVD-P: Female\"),\n       bty=\"n\",cex=.8, col=c(\"black\",\"red\",\"black\",\"red\"), lty=c(1,1,2,2))\n\nplot(d1_himi$x, d1_himi$y, type=\"n\", xlim=c(.8, 3.1), ylim=c(0,3.3), las=1, xlab=\"Treatment Effect by HIMI Status\", ylab=\"Density\")\nlines(d1_himi$x, d1_himi$y, col=\"red\", lwd=2)\nlines(d2_himi$x, d2_himi$y, col=\"black\", lwd=2)\nlines(d3_himi$x, d3_himi$y, col=\"red\", lwd=2, lty=2)\nlines(d4_himi$x, d4_himi$y, col=\"black\", lwd=2, lty=2)\nlegend(\"topright\", legend=c(\"SOLVD-T: HIMI\", \"SOLVD-T: No HIMI\", \"SOLVD-P: HIMI\", \"SOLVD-P: No HIMI\"),\n       bty=\"n\", cex=.8, col=c(\"black\",\"red\",\"black\",\"red\"), lty=c(1,1,2,2))\n#dev.off()\n\n\n",
    "created" : 1522094997541.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3196740356",
    "id" : "A0E40BB4",
    "lastKnownWriteTime" : 1522645708,
    "last_content_update" : 1522645708934,
    "path" : "~/personalized/FinPaperGraphs/nonlinearities_explore.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled39"
    },
    "relative_order" : 34,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}