{
    "collab_server" : "",
    "contents" : "\n\n\n\nload(\"~/personalized/Data/solvd_fit.RData\")\nload(\"~/personalized/Data/solvd_fit_log.RData\")\n\nsource(\"~/personalized/PartialDepend/PartialDependencePlots.R\")\ndata(solvd_pt)\n\n\ns1 <- solvd$study==\"SOLVD Treatment\" & solvd$gender==\"male\"\ns2 <- solvd$study==\"SOLVD Treatment\" & solvd$gender==\"female\"\ns3 <- solvd$study==\"SOLVD Prevention\" & solvd$gender==\"male\"\ns4 <- solvd$study==\"SOLVD Prevention\" & solvd$gender==\"female\"\n\nthet1 <- rowMeans(obj$Theta[,s1])\nthet2 <- rowMeans(obj$Theta[,s2])\nthet3 <- rowMeans(obj$Theta[,s3])\nthet4 <- rowMeans(obj$Theta[,s4])\n\n\ns1_diabet <- solvd$study==\"SOLVD Treatment\" & solvd$himi==1\ns2_diabet <- solvd$study==\"SOLVD Treatment\" & solvd$himi==0\ns3_diabet <- solvd$study==\"SOLVD Prevention\" & solvd$himi==1\ns4_diabet <- solvd$study==\"SOLVD Prevention\" & solvd$himi==0\n\nthet1_d <- rowMeans(obj$Theta[,s1_diabet])\nthet2_d <- rowMeans(obj$Theta[,s2_diabet])\nthet3_d <- rowMeans(obj$Theta[,s3_diabet])\nthet4_d <- rowMeans(obj$Theta[,s4_diabet])\n\nd1 <- density(thet1)\nd2 <- density(thet2)\nd3 <- density(thet3)\nd4 <- density(thet4)\n\n\nd1_himi <- density(thet1_d)\nd2_himi <- density(thet2_d)\nd3_himi <- density(thet3_d)\nd4_himi <- density(thet4_d)\n\n\n#### Now just need partial dependence plots for baseline ejection fraction.\n\n\nform <- ttodthorchfhosp ~ study + trt + age + smoke + diabet + lvef + himi + nyha + depedema + crackles + weightkg + anydiurbl + avsys + avdia + beat + creatinine + sodium + copd + histk + gender - 1\nXX <- model.matrix(form, solvd)\ncolnames(XX)[8]\ncolnames(XX)[18]\nstatus <- solvd$deathorchfhosp\nyy <- solvd$ttodthorchfhosp\n\n\n#load(\"~/personalized/Data/partialdepend_dat.RData\")\n\nzseq <- seq(10, 35, length.out=25)\nzzseq <- seq(.4, 3.5, length.out=25)\nnsk <- 500\nnpo <- 1000\npdd <- PartialDependence(z=zseq, col.p=8, Trt.col=3, X=XX, y=yy, status=status, nskip=nsk, ndpost=npo)\npdd_cret <- PartialDependence(z=zzseq, col.p=18, Trt.col=3, X=XX, y=yy, status=status, nskip=nsk, ndpost=npo)\n\n### How to save?\nsave(zseq, zzseq, pdd, pdd_cret, file=\"~/personalized/Data/partialdepend_dat.RData\")\n\n####  Plot Graphs\n#par(mar=c(5.1,4.1,4.1,2.1)\n## bottom, left, top, right\n\npdsmooth <- supsmu(zseq, pdd$mean)\npdsmooth_low <- supsmu(zseq, pdd$lower)\npdsmooth_up <- supsmu(zseq, pdd$upper)\n\n\npdsmooth_cret <- supsmu(zzseq, pdd_cret$mean)\npdsmooth_cret_low <- supsmu(zzseq, pdd_cret$lower)\npdsmooth_cret_up <- supsmu(zzseq, pdd_cret$upper)\n\n#zseq <- zseq/100\npostscript(file=\"~/workingpapers/AFTpersonal/Figures/pd_plots.eps\", width=6.5,\n           height=5, horizontal=FALSE)\npar(mfrow=c(2,2), mar=c(3.6, 3.6,.15,.05), mgp=c(1.75,.5,0))\nplot(zseq, pdd$mean, type=\"n\", las=1, xlim=c(.1, .35), ylim=c(-.2,1.0), xlab=\"Ejection Fraction\",\n     ylab=\"Difference in log survival\")\nlines(pdsmooth$x/100, pdsmooth$y)\nlines(pdsmooth$x/100, pdsmooth_low$y, lty=2)\nlines(pdsmooth$x/100, pdsmooth_up$y, lty=2)\n\nplot(zzseq, pdd_cret$mean, type=\"n\", las=1, xlim=c(.4, 3.5), ylim=c(-.2,1.0), xlab=\"Creatinine\",\n     ylab=\"Difference in log survival\")\nlines(pdsmooth_cret$x, pdsmooth_cret$y)\nlines(pdsmooth_cret$x, pdsmooth_cret_low$y, lty=2)\nlines(pdsmooth_cret$x, pdsmooth_cret_up$y, lty=2)\n\n## Need to change this to ratio scale\n\nplot(d1$x, d1$y, type=\"n\", xlim=c(.7, 2.9), ylim=c(0,3.3), las=1, xlab=\"Treatment Effect by Gender\", ylab=\"Density\")\nlines(d1$x, d1$y, col=\"red\", lwd=2)\nlines(d2$x, d2$y, col=\"black\", lwd=2)\nlines(d3$x, d3$y, col=\"red\", lwd=2, lty=2)\nlines(d4$x, d4$y, col=\"black\", lwd=2, lty=2)\nlegend(\"topright\", legend=c(\"SOLVD-T: Male\", \"SOLVD-T: Female\", \"SOLVD-P: Male\", \"SOLVD-P: Female\"),\n       bty=\"n\",cex=.8, col=c(\"black\",\"red\",\"black\",\"red\"), lty=c(1,1,2,2))\n\nplot(d1_himi$x, d1_himi$y, type=\"n\", xlim=c(.8, 3.1), ylim=c(0,3.3), las=1, xlab=\"Treatment Effect by HIMI Status\", ylab=\"Density\")\nlines(d1_himi$x, d1_himi$y, col=\"red\", lwd=2)\nlines(d2_himi$x, d2_himi$y, col=\"black\", lwd=2)\nlines(d3_himi$x, d3_himi$y, col=\"red\", lwd=2, lty=2)\nlines(d4_himi$x, d4_himi$y, col=\"black\", lwd=2, lty=2)\nlegend(\"topright\", legend=c(\"SOLVD-T: HIMI\", \"SOLVD-T: No HIMI\", \"SOLVD-P: HIMI\", \"SOLVD-P: No HIMI\"),\n       bty=\"n\", cex=.8, col=c(\"black\",\"red\",\"black\",\"red\"), lty=c(1,1,2,2))\ndev.off()\n\n\n",
    "created" : 1522094828396.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3528448443",
    "id" : "92D9217A",
    "lastKnownWriteTime" : 1484251877,
    "last_content_update" : 1484251877,
    "path" : "~/personalized/FinPaperGraphs/genderlvef_graphs.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled24"
    },
    "relative_order" : 32,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}